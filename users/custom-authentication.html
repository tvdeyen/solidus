<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guidelines | Custom authentication</title>
    <meta name="description" content="Developer Guides for Solidus">
    <link rel="shortcut icon" href="/solidus/favicon.ico">
  <link rel="apple-touch-icon" href="/solidus/apple-touch-icon.png">
    
    <link rel="preload" href="/solidus/assets/css/73.styles.eab8b2ae.css" as="style"><link rel="preload" href="/solidus/assets/js/app.8a40fd93.js" as="script"><link rel="preload" href="/solidus/assets/js/2.d4e88151.js" as="script"><link rel="prefetch" href="/solidus/assets/js/37.b74e6c67.js"><link rel="prefetch" href="/solidus/assets/js/1.bc8aaa90.js"><link rel="prefetch" href="/solidus/assets/js/3.e88dfa7e.js"><link rel="prefetch" href="/solidus/assets/js/4.7b7ea6ef.js"><link rel="prefetch" href="/solidus/assets/js/5.8bb30487.js"><link rel="prefetch" href="/solidus/assets/js/6.6430c6fd.js"><link rel="prefetch" href="/solidus/assets/js/7.573fb1d2.js"><link rel="prefetch" href="/solidus/assets/js/8.9360dac4.js"><link rel="prefetch" href="/solidus/assets/js/9.bc0513d0.js"><link rel="prefetch" href="/solidus/assets/js/10.9de329d0.js"><link rel="prefetch" href="/solidus/assets/js/11.3ef794fe.js"><link rel="prefetch" href="/solidus/assets/js/12.a9f19247.js"><link rel="prefetch" href="/solidus/assets/js/13.10bdcfc3.js"><link rel="prefetch" href="/solidus/assets/js/14.baeb49cf.js"><link rel="prefetch" href="/solidus/assets/js/15.4d27d13f.js"><link rel="prefetch" href="/solidus/assets/js/16.4dbd3af2.js"><link rel="prefetch" href="/solidus/assets/js/17.96a840b0.js"><link rel="prefetch" href="/solidus/assets/js/18.7af603a9.js"><link rel="prefetch" href="/solidus/assets/js/19.944f2391.js"><link rel="prefetch" href="/solidus/assets/js/20.0d3a03ca.js"><link rel="prefetch" href="/solidus/assets/js/21.6f8a3623.js"><link rel="prefetch" href="/solidus/assets/js/22.1ab16961.js"><link rel="prefetch" href="/solidus/assets/js/23.c5a09552.js"><link rel="prefetch" href="/solidus/assets/js/24.01d33ebc.js"><link rel="prefetch" href="/solidus/assets/js/25.368e20d3.js"><link rel="prefetch" href="/solidus/assets/js/26.0ff243dc.js"><link rel="prefetch" href="/solidus/assets/js/27.379ef86c.js"><link rel="prefetch" href="/solidus/assets/js/28.b1d94d4e.js"><link rel="prefetch" href="/solidus/assets/js/29.a582c0f5.js"><link rel="prefetch" href="/solidus/assets/js/30.75b3694e.js"><link rel="prefetch" href="/solidus/assets/js/31.32737bfe.js"><link rel="prefetch" href="/solidus/assets/js/32.68e6e17c.js"><link rel="prefetch" href="/solidus/assets/js/33.1e8efaaa.js"><link rel="prefetch" href="/solidus/assets/js/34.349d8482.js"><link rel="prefetch" href="/solidus/assets/js/35.78fdbd6e.js"><link rel="prefetch" href="/solidus/assets/js/36.0b2759fa.js"><link rel="prefetch" href="/solidus/assets/js/0.594398bd.js"><link rel="prefetch" href="/solidus/assets/js/38.bccdd185.js"><link rel="prefetch" href="/solidus/assets/js/39.ad7f257e.js"><link rel="prefetch" href="/solidus/assets/js/40.18604395.js"><link rel="prefetch" href="/solidus/assets/js/41.0e64d55c.js"><link rel="prefetch" href="/solidus/assets/js/42.83301a40.js"><link rel="prefetch" href="/solidus/assets/js/43.f596cdc7.js"><link rel="prefetch" href="/solidus/assets/js/44.07f48a7c.js"><link rel="prefetch" href="/solidus/assets/js/45.a59da533.js"><link rel="prefetch" href="/solidus/assets/js/46.adca66b1.js"><link rel="prefetch" href="/solidus/assets/js/47.61b9b3b8.js"><link rel="prefetch" href="/solidus/assets/js/48.94da6411.js"><link rel="prefetch" href="/solidus/assets/js/49.045da191.js"><link rel="prefetch" href="/solidus/assets/js/50.4aa1c95a.js"><link rel="prefetch" href="/solidus/assets/js/51.3f25a7cb.js"><link rel="prefetch" href="/solidus/assets/js/52.7fc3e97e.js"><link rel="prefetch" href="/solidus/assets/js/53.478f3a20.js"><link rel="prefetch" href="/solidus/assets/js/54.bee46771.js"><link rel="prefetch" href="/solidus/assets/js/55.d22fc5aa.js"><link rel="prefetch" href="/solidus/assets/js/56.2779de7d.js"><link rel="prefetch" href="/solidus/assets/js/57.9229e917.js"><link rel="prefetch" href="/solidus/assets/js/58.53b44760.js"><link rel="prefetch" href="/solidus/assets/js/59.b4ab94d2.js"><link rel="prefetch" href="/solidus/assets/js/60.024d7dba.js"><link rel="prefetch" href="/solidus/assets/js/61.c0c81db2.js"><link rel="prefetch" href="/solidus/assets/js/62.9766010b.js"><link rel="prefetch" href="/solidus/assets/js/63.a22ac1c9.js"><link rel="prefetch" href="/solidus/assets/js/64.711f7334.js"><link rel="prefetch" href="/solidus/assets/js/65.0f534f00.js"><link rel="prefetch" href="/solidus/assets/js/66.e38c54e1.js"><link rel="prefetch" href="/solidus/assets/js/67.a395f431.js"><link rel="prefetch" href="/solidus/assets/js/68.f86e2d51.js"><link rel="prefetch" href="/solidus/assets/js/69.6f1fc43a.js"><link rel="prefetch" href="/solidus/assets/js/70.944af6a0.js"><link rel="prefetch" href="/solidus/assets/js/71.1f9a1de8.js"><link rel="prefetch" href="/solidus/assets/js/72.3e4d2c2a.js">
    <link rel="stylesheet" href="/solidus/assets/css/73.styles.eab8b2ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/solidus/" class="home-link router-link-active"><img src="/solidus/logo.svg" class="logo"><span class="site-name can-hide">
      Guidelines
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/solidus/" class="nav-link">Home</a></div><a href="https://github.com/solidusio/solidus" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/solidus/" class="nav-link">Home</a></div><a href="https://github.com/solidusio/solidus" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>Getting Started</span><span class="arrow up"></span></p><ul class="sidebar-group-items"><li><a href="/solidus/getting-started/first-time-installation.html" class="sidebar-link">First-time installation</a></li><li><a href="/solidus/getting-started/installation-options.html" class="sidebar-link">Installation options</a></li><li><a href="/solidus/getting-started/develop-solidus.html" class="sidebar-link">Develop Solidus</a></li><li><a href="/solidus/getting-started/forking-solidus.html" class="sidebar-link">Forking Solidus</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Preferences</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Locations</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Payments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Taxation</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Shipments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Calculators</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Assets</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Views</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Products and Variants</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Inventory</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Returns</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Promotions</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Adjustments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Orders</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Returns</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Users</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Upgrades</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Extensions</span><span class="arrow down"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="custom-authentication"><a href="#custom-authentication" aria-hidden="true" class="header-anchor">#</a> Custom authentication</h1><p><em>You can use the official <a href="https://github.com/solidusio/solidus_auth_devise" target="_blank" rel="noopener noreferrer"><code>solidus_auth_devise</code></a> gem
to provide a <code>Spree::User</code> model and basic authentication for Solidus. See its
documentation for additional setup instructions.</em></p><p>Stores require a <code>User</code> model in order to take advantage of all of Solidus's
features. This model can have any name, and Solidus can integrate with your
existing Rails application's existing <code>User</code> model.</p><p>By default, Solidus provides a <a href="https://github.com/solidusio/solidus/blob/master/core/app/models/spree/legacy_user.rb" target="_blank" rel="noopener noreferrer"><code>Spree::LegacyUser</code> model</a> that
offers the bare minimum functionality of a user. The model is only suitable for
testing and should not be used in a production environment.</p><p>The rest of this article outlines the steps required should you decide to create
a <code>User</code> model from scratch, use an authentication solution like
<a href="https://github.com/plataformatec/devise" target="_blank" rel="noopener noreferrer">Devise</a>, or integrate your application's existing <code>User</code> model.</p><p>Note that while your user model can have whatever name you like, this article
uses the model <code>MyStore::User</code> for its examples.</p><h2 id="set-the-spree-user-class"><a href="#set-the-spree-user-class" aria-hidden="true" class="header-anchor">#</a> Set the Spree.user_class</h2><p>No matter what gem or extension you use for your store's <code>User</code> model, your
application's <code>Spree.user_class</code> value needs to be set. By default, Solidus sets
the <code>Spree.user_class</code> to <code>Spree::LegacyUser</code>.</p><p>You can configure a custom <code>Spree.user_class</code> in your application's
<code>/config/initializers/spree.rb</code> file:</p><pre class="language-ruby"><code><span class="token comment"># /config/initializers/spree.rb</span>
<span class="token constant">Spree</span><span class="token punctuation">.</span>user_class <span class="token operator">=</span> <span class="token string">&quot;MyStore::User&quot;</span>
</code></pre><p>If you use the <code>solidus_auth_devise</code> gem, your <code>Spree.user_class</code> is set to
<code>Spree::User</code> when you run the gem's <code>solidus:auth:install</code> generator.</p><h2 id="prepare-your-user-model-for-solidus"><a href="#prepare-your-user-model-for-solidus" aria-hidden="true" class="header-anchor">#</a> Prepare your user model for Solidus</h2><p>Once you have set the <code>Spree.user_class</code>, you can start integrating with the
features that are associated with the <code>user_class</code>.</p><h3 id="custom-user-generator"><a href="#custom-user-generator" aria-hidden="true" class="header-anchor">#</a> Custom user generator</h3><p>After you have created your custom <code>User</code> model and its corresponding database
table, you can use the <code>spree:custom_user</code> generator to generate Solidus's
required <code>User</code> table columns and some authentication helpers:</p><pre class="language-bash"><code>bundle <span class="token function">exec</span> rails generate spree:custom_user MyStore::User
</code></pre><p>Then, you can migrate your database to add the Solidus-specific <code>User</code> table
columns:</p><pre class="language-bash"><code>bundle <span class="token function">exec</span> rails db:migrate
</code></pre><p>If you use the <code>spree:custom_user</code> generator:</p><ul><li>The <code>Spree.user_class</code> is updated to your specified class.</li><li>Authentication helpers are set up for the <code>solidus_frontend</code> and
<code>solidus_backend</code> views and are sent to the application controller, making it
available throughout your application.</li><li>The <code>spree_current_user</code> method is defined and is sent to the application
controller and the <code>Spree::Api::BaseController</code>, making it available
throughout your application.</li></ul><h3 id="minimum-requirements"><a href="#minimum-requirements" aria-hidden="true" class="header-anchor">#</a> Minimum requirements</h3><p>Solidus requires that your <code>User</code> model's database table includes at least the
following columns:</p><ul><li><code>spree_api_key</code>: A string with a user's API key. This should be limited to 48
characters.</li><li><code>bill_address_id</code>: An integer that provides the ID of the <code>Spree::Address</code>
that should be used as the current user's billing address.</li><li><code>ship_address_id</code>: An integer that provides the ID of the <code>Spree::Address</code>
that should be used as the current user's shipping address.</li></ul><p>These three columns are generated for you by the <a href="#custom-user-generator"><code>spree:custom_user</code>
generator</a>.</p><p>It also requires that you have a <a href="#spree-current-user"><code>spree_current_user</code></a>
helper method.</p><h4 id="user-passwords"><a href="#user-passwords" aria-hidden="true" class="header-anchor">#</a> User passwords</h4><p>Note that if you use the stock <code>solidus_frontend</code> or <code>solidus_backend</code> gems,
your user should also have a <code>password</code> column. You can set up a password column
however you see fit.</p><h3 id="spree-current-user"><a href="#spree-current-user" aria-hidden="true" class="header-anchor">#</a> spree_current_user</h3><p>If you use the stock <code>solidus_frontend</code> or <code>solidus_backend</code> gems, you need to
provide a <code>spree_current_user</code> helper method. Because you likely need to
reference the current user throughout your application, we recommend adding it
to your <code>application_controller.rb</code>.</p><p>If you use an authentication gem that defines a <code>current_user</code> (like Devise),
you may want to just wrap <code>current_user</code> in a <code>spree_current_user</code> method:</p><pre class="language-ruby"><code><span class="token comment"># /app/controllers/application_controller.rb</span>
<span class="token keyword">class</span> <span class="token class-name">ApplicationController</span> <span class="token operator">&lt;</span> <span class="token constant">ActionController</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>

  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  helper_method <span class="token symbol">:spree_current_user</span>

  <span class="token keyword">def</span> spree_current_user
    current_user
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre><p>This helper can be generated for you by the <a href="#custom-user-generator"><code>spree:custom_user</code>
generator</a>.</p><h3 id="add-authentication-helpers"><a href="#add-authentication-helpers" aria-hidden="true" class="header-anchor">#</a> Add authentication helpers</h3><p>If you use the stock <code>solidus_frontend</code> or <code>solidus_backend</code> gems, you need to
provide authentication helpers so that users can sign up, log in, and log out.
Because you likely need to reference the current user throughout your
application, we recommend adding it to you <code>application_controller.rb</code>:</p><pre class="language-ruby"><code><span class="token comment"># /app/controllers/application_controller.rb</span>
<span class="token keyword">class</span> <span class="token class-name">ApplicationController</span> <span class="token operator">&lt;</span> <span class="token constant">ActionController</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>

  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  helper_method <span class="token symbol">:spree_login_path</span>
  helper_method <span class="token symbol">:spree_signup_path</span>
  helper_method <span class="token symbol">:spree_logout_path</span>

  <span class="token keyword">def</span> spree_login_path
    login_path
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> spree_signup_path
    signup_path
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> spree_logout_path
    logout_path
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre><p>These helpers can be generated for you by the <a href="#custom-user-generator"><code>spree:custom_user</code>
generator</a>.</p><h3 id="add-solidus-user-methods"><a href="#add-solidus-user-methods" aria-hidden="true" class="header-anchor">#</a> Add Solidus user methods</h3><p>The <a href="https://github.com/solidusio/solidus/blob/master/core/app/models/concerns/spree/user_methods.rb" target="_blank" rel="noopener noreferrer"><code>Spree::UserMethods</code> module</a> provides extensive
integration for a <code>User</code> model. User methods allow a <code>User</code> object to relate to
other major models in Solidus like <code>Spree::Order</code>s and <code>Spree::StoreCredit</code>s.</p><p>To add user methods to your <code>User</code> model, include <code>Spree::UserMethods</code> in it:</p><pre class="language-ruby"><code><span class="token keyword">module</span> <span class="token constant">MyStore</span>
  <span class="token keyword">class</span> <span class="token class-name">User</span>
    include <span class="token constant">Spree</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">UserMethods</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><h3 id="give-your-store-administrator-the-admin-role"><a href="#give-your-store-administrator-the-admin-role" aria-hidden="true" class="header-anchor">#</a> Give your store administrator the admin role</h3><p>In order for store administrators to use the <code>solidus_backend</code> admin, you need a
user with the <code>Spree::Role</code> of <code>admin</code>. You can give any existing user the
<code>admin</code> role like this:</p><pre class="language-ruby"><code>user <span class="token operator">=</span> <span class="token constant">MyStore</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">User</span><span class="token punctuation">.</span><span class="token function">find_by</span><span class="token punctuation">(</span>email<span class="token punctuation">:</span> <span class="token string">'admin@example.com'</span><span class="token punctuation">)</span>
user<span class="token punctuation">.</span>spree_roles <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token constant">Spree</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Role</span><span class="token punctuation">.</span><span class="token function">find_or_create_by</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">)</span>
</code></pre><p>Now, your user with the <code>admin@example.com</code> email address should be able to
access the <code>solidus_backend</code> interface at <code>mystore.com/admin</code>.</p></div><div class="content edit-link"><a href="https://github.com/solidusio/solidus/edit/master/guides/users/custom-authentication.md" target="_blank" rel="noopener noreferrer">Edit this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div></div></div>
    <script src="/solidus/assets/js/2.d4e88151.js" defer></script><script src="/solidus/assets/js/app.8a40fd93.js" defer></script>
  </body>
</html>
