<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guidelines | Overview</title>
    <meta name="description" content="Developer Guides for Solidus">
    <link rel="shortcut icon" href="/solidus/favicon.ico">
  <link rel="apple-touch-icon" href="/solidus/apple-touch-icon.png">
    
    <link rel="preload" href="/solidus/assets/css/73.styles.eab8b2ae.css" as="style"><link rel="preload" href="/solidus/assets/js/app.8a40fd93.js" as="script"><link rel="preload" href="/solidus/assets/js/69.6f1fc43a.js" as="script"><link rel="prefetch" href="/solidus/assets/js/37.b74e6c67.js"><link rel="prefetch" href="/solidus/assets/js/1.bc8aaa90.js"><link rel="prefetch" href="/solidus/assets/js/2.d4e88151.js"><link rel="prefetch" href="/solidus/assets/js/3.e88dfa7e.js"><link rel="prefetch" href="/solidus/assets/js/4.7b7ea6ef.js"><link rel="prefetch" href="/solidus/assets/js/5.8bb30487.js"><link rel="prefetch" href="/solidus/assets/js/6.6430c6fd.js"><link rel="prefetch" href="/solidus/assets/js/7.573fb1d2.js"><link rel="prefetch" href="/solidus/assets/js/8.9360dac4.js"><link rel="prefetch" href="/solidus/assets/js/9.bc0513d0.js"><link rel="prefetch" href="/solidus/assets/js/10.9de329d0.js"><link rel="prefetch" href="/solidus/assets/js/11.3ef794fe.js"><link rel="prefetch" href="/solidus/assets/js/12.a9f19247.js"><link rel="prefetch" href="/solidus/assets/js/13.10bdcfc3.js"><link rel="prefetch" href="/solidus/assets/js/14.baeb49cf.js"><link rel="prefetch" href="/solidus/assets/js/15.4d27d13f.js"><link rel="prefetch" href="/solidus/assets/js/16.4dbd3af2.js"><link rel="prefetch" href="/solidus/assets/js/17.96a840b0.js"><link rel="prefetch" href="/solidus/assets/js/18.7af603a9.js"><link rel="prefetch" href="/solidus/assets/js/19.944f2391.js"><link rel="prefetch" href="/solidus/assets/js/20.0d3a03ca.js"><link rel="prefetch" href="/solidus/assets/js/21.6f8a3623.js"><link rel="prefetch" href="/solidus/assets/js/22.1ab16961.js"><link rel="prefetch" href="/solidus/assets/js/23.c5a09552.js"><link rel="prefetch" href="/solidus/assets/js/24.01d33ebc.js"><link rel="prefetch" href="/solidus/assets/js/25.368e20d3.js"><link rel="prefetch" href="/solidus/assets/js/26.0ff243dc.js"><link rel="prefetch" href="/solidus/assets/js/27.379ef86c.js"><link rel="prefetch" href="/solidus/assets/js/28.b1d94d4e.js"><link rel="prefetch" href="/solidus/assets/js/29.a582c0f5.js"><link rel="prefetch" href="/solidus/assets/js/30.75b3694e.js"><link rel="prefetch" href="/solidus/assets/js/31.32737bfe.js"><link rel="prefetch" href="/solidus/assets/js/32.68e6e17c.js"><link rel="prefetch" href="/solidus/assets/js/33.1e8efaaa.js"><link rel="prefetch" href="/solidus/assets/js/34.349d8482.js"><link rel="prefetch" href="/solidus/assets/js/35.78fdbd6e.js"><link rel="prefetch" href="/solidus/assets/js/36.0b2759fa.js"><link rel="prefetch" href="/solidus/assets/js/0.594398bd.js"><link rel="prefetch" href="/solidus/assets/js/38.bccdd185.js"><link rel="prefetch" href="/solidus/assets/js/39.ad7f257e.js"><link rel="prefetch" href="/solidus/assets/js/40.18604395.js"><link rel="prefetch" href="/solidus/assets/js/41.0e64d55c.js"><link rel="prefetch" href="/solidus/assets/js/42.83301a40.js"><link rel="prefetch" href="/solidus/assets/js/43.f596cdc7.js"><link rel="prefetch" href="/solidus/assets/js/44.07f48a7c.js"><link rel="prefetch" href="/solidus/assets/js/45.a59da533.js"><link rel="prefetch" href="/solidus/assets/js/46.adca66b1.js"><link rel="prefetch" href="/solidus/assets/js/47.61b9b3b8.js"><link rel="prefetch" href="/solidus/assets/js/48.94da6411.js"><link rel="prefetch" href="/solidus/assets/js/49.045da191.js"><link rel="prefetch" href="/solidus/assets/js/50.4aa1c95a.js"><link rel="prefetch" href="/solidus/assets/js/51.3f25a7cb.js"><link rel="prefetch" href="/solidus/assets/js/52.7fc3e97e.js"><link rel="prefetch" href="/solidus/assets/js/53.478f3a20.js"><link rel="prefetch" href="/solidus/assets/js/54.bee46771.js"><link rel="prefetch" href="/solidus/assets/js/55.d22fc5aa.js"><link rel="prefetch" href="/solidus/assets/js/56.2779de7d.js"><link rel="prefetch" href="/solidus/assets/js/57.9229e917.js"><link rel="prefetch" href="/solidus/assets/js/58.53b44760.js"><link rel="prefetch" href="/solidus/assets/js/59.b4ab94d2.js"><link rel="prefetch" href="/solidus/assets/js/60.024d7dba.js"><link rel="prefetch" href="/solidus/assets/js/61.c0c81db2.js"><link rel="prefetch" href="/solidus/assets/js/62.9766010b.js"><link rel="prefetch" href="/solidus/assets/js/63.a22ac1c9.js"><link rel="prefetch" href="/solidus/assets/js/64.711f7334.js"><link rel="prefetch" href="/solidus/assets/js/65.0f534f00.js"><link rel="prefetch" href="/solidus/assets/js/66.e38c54e1.js"><link rel="prefetch" href="/solidus/assets/js/67.a395f431.js"><link rel="prefetch" href="/solidus/assets/js/68.f86e2d51.js"><link rel="prefetch" href="/solidus/assets/js/70.944af6a0.js"><link rel="prefetch" href="/solidus/assets/js/71.1f9a1de8.js"><link rel="prefetch" href="/solidus/assets/js/72.3e4d2c2a.js">
    <link rel="stylesheet" href="/solidus/assets/css/73.styles.eab8b2ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/solidus/" class="home-link router-link-active"><img src="/solidus/logo.svg" class="logo"><span class="site-name can-hide">
      Guidelines
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/solidus/" class="nav-link">Home</a></div><a href="https://github.com/solidusio/solidus" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/solidus/" class="nav-link">Home</a></div><a href="https://github.com/solidusio/solidus" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Preferences</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Locations</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Payments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Taxation</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Shipments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Calculators</span><span class="arrow up"></span></p><ul class="sidebar-group-items"><li><a href="/solidus/calculators/overview.html" class="active sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/solidus/calculators/overview.html#attributes" class="sidebar-link">Attributes</a></li><li class="sidebar-sub-header"><a href="/solidus/calculators/overview.html#calculables" class="sidebar-link">Calculables</a></li><li class="sidebar-sub-header"><a href="/solidus/calculators/overview.html#preferences" class="sidebar-link">Preferences</a></li><li class="sidebar-sub-header"><a href="/solidus/calculators/overview.html#custom-calculators" class="sidebar-link">Custom calculators</a></li></ul></li><li><a href="/solidus/calculators/promotion-calculators.html" class="sidebar-link">Promotion calculators</a></li><li><a href="/solidus/calculators/shipping-calculators.html" class="sidebar-link">Shipping calculators</a></li><li><a href="/solidus/calculators/tax-calculator.html" class="sidebar-link">Tax calculator</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Assets</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Views</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Products and Variants</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Inventory</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Returns</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Promotions</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Adjustments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Orders</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Returns</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Users</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Upgrades</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Extensions</span><span class="arrow down"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h1><p>All calculators in Solidus inherit from the <code>Spree::Calculator</code> base class. They
calculate and return the value of promotions, taxes, and shipping charges.
Solidus includes built-in calculators for common types of calculations, such as
flat rate shipping, percentage discounts, sales tax, and value-added tax (VAT).</p><p>Whenever you create a new shipping method, tax rate, or promotion action, you
also create a new instance of a <code>Spree::Calculator</code>.</p><p>For example, if you create a new shipping method called &quot;USPS Ground&quot; that
charges a flat rate of $10 USD, you would be creating an instance of the
<code>Spree::Calculator::Shipping::FlatRate</code> calculator:</p><ul><li>The new calculator instance would have <code>calculable_type</code> of
<code>Spree::ShippingMethod</code>. This is because it has a polymorphic relationship
with a shipping method, rather than a tax rate or promotion action. See
<a href="#calculables">calculables</a> for more information about this relationship.</li><li>The new calculator instance's <code>preferences</code> attribute would have a value of
<code>{:preference=&gt;10, :currency=&gt;&quot;USD&quot;}</code>.</li></ul><h2 id="attributes"><a href="#attributes" aria-hidden="true" class="header-anchor">#</a> Attributes</h2><p><code>Spree::Calculator</code> objects have the following attributes:</p><ul><li><code>type</code>: The type of calculator being used. For example, if the object
calculates shipping, it could be any available shipping calculator, such as
<code>Spree::Calculator::Shipping::FlatRate</code>.</li><li><code>calculable_type</code> and <code>calculable_id</code>: The calculable type and its matching
ID. For example, if the object calculates shipping, the calculable would be
from the <code>Spree::ShippingMethod</code> model. See <a href="#calculables">calculables</a> for
more information.</li><li><code>preferences</code>: A hash of the calculator's preferences and the values of those
preferences. Each type of calculator has its own preferences. See
<a href="#preferences">preferences</a> for more information.</li></ul><h2 id="calculables"><a href="#calculables" aria-hidden="true" class="header-anchor">#</a> Calculables</h2><p>A calculable is an object that needs to be calculated by a <code>Spree::Calculator</code>.
In Rails, this is an example of a <a href="http://guides.rubyonrails.org/association_basics.html#polymorphic-associations" target="_blank" rel="noopener noreferrer">polymorphic association</a>:
all calculators share a common base class, but they can calculate different
types of objects.</p><p>In the case of <code>Spree::Calculator</code>s, there are three different
<code>calculable_types</code>:</p><ul><li><code>Spree::ShippingMethod</code></li><li><code>Spree::TaxRate</code></li><li><code>Spree::PromotionAction</code></li></ul><p>A calculable <code>include</code>s the <code>Spree::CalculatedAdjustments</code> module. This module
requires that each calculable has one calculator object. So, for each calculable
object, an instance of a <code>Spree::Calculator</code> should also be created.</p><p>For example, a shipping method called &quot;USPS Ground&quot; charges a flat rate of $10
USD. The shipping method is calculable and requires an associated calculator.
So, the rate for each shipment is calculated by the associated
<code>Spree::Calculator::Shipping::FlatRate</code> object.</p><p>Similarly, each tax rate in your store is calculable. So, instance of the
<code>Spree::Calculator::DefaultTax</code> calculator is created and calculates the amount
of tax that should be applied to line items, shipments, or orders.</p><h2 id="preferences"><a href="#preferences" aria-hidden="true" class="header-anchor">#</a> Preferences</h2><p>Each <code>Spree::Calculator</code> has <a href="/solidus/preferences/add-model-preferences.html">static model preferences</a>. Each
instances of a calculator has a <code>preferences</code> attribute that stores a hash of
preferences.</p><p>For example, you may have two flat shipping rates configured in your store.
If you look up each of  your <code>Spree::Calculator::Shipping::FlatRate</code> calculators,
you can see how the static preferences have different settings:</p><pre class="language-ruby"><code><span class="token constant">Spree</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Calculator</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Shipping</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FlatRate</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>preferences
<span class="token comment"># =&gt; {:amount=&gt;8, :currency=&gt;&quot;USD&quot;}</span>

<span class="token constant">Spree</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Calculator</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Shipping</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FlatRate</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>preferences
<span class="token comment"># =&gt; {:amount=&gt;4, :currency=&gt;&quot;EUR&quot;}</span>
</code></pre><p>Because each type of calculator has different functionality, each calculator has its own
set of preferences.</p><p>For example, a calculator that uses a percentage for calculations would not have
a <code>:currency</code> preference, but any calculator that uses a specific amount of
currency would have a <code>:currency</code> preference::</p><pre class="language-ruby"><code><span class="token constant">Spree</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Calculator</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Shipping</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FlatRate</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>preferences
<span class="token comment"># =&gt; {:amount=&gt;4, :currency=&gt;&quot;EUR&quot;}</span>

<span class="token constant">Spree</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Calculators</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Shipping</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FlatPercentItemTotal</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>preferences
<span class="token comment"># =&gt; {:flat_percent=&gt;0.2e1}</span>
</code></pre><h3 id="preferred-methods"><a href="#preferred-methods" aria-hidden="true" class="header-anchor">#</a> Preferred methods</h3><p>For each preference on a calculator, you can use a <code>preferred_&lt;preference&gt;</code>
method to get or set the value of the preference (where <code>&lt;preference&gt;</code> is the
name of the preference). For example</p><pre class="language-ruby"><code><span class="token constant">Spree</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Calculator</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>preferred_amount<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span>
</code></pre><h2 id="custom-calculators"><a href="#custom-calculators" aria-hidden="true" class="header-anchor">#</a> Custom calculators</h2><p>If Solidus's built-in calculators are not sufficient for your store, you can
create your own custom calculators. Because promotion, shipping, and tax
calculators have different requirements, we have an article describing each type
of custom calculator you may want to build:</p><ul><li>Custom promotions calculator [Note: work in progress]</li><li><a href="/solidus/shipments/custom-shipping-calculators.html">Custom shipping calculators</a></li><li><a href="/solidus/taxation/custom-tax-calculators.html">Custom tax calculators</a></li></ul></div><div class="content edit-link"><a href="https://github.com/solidusio/solidus/edit/master/guides/calculators/overview.md" target="_blank" rel="noopener noreferrer">Edit this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/solidus/shipments/custom-shipping-calculators.html" class="prev">
          Custom shipping calculators
        </a></span><span class="next"><a href="/solidus/calculators/promotion-calculators.html">
          Promotion calculators
        </a> →
      </span></p></div></div></div></div>
    <script src="/solidus/assets/js/69.6f1fc43a.js" defer></script><script src="/solidus/assets/js/app.8a40fd93.js" defer></script>
  </body>
</html>
