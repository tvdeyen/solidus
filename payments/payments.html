<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guidelines | Payments</title>
    <meta name="description" content="Developer Guides for Solidus">
    <link rel="shortcut icon" href="/solidus/favicon.ico">
  <link rel="apple-touch-icon" href="/solidus/apple-touch-icon.png">
    
    <link rel="preload" href="/solidus/assets/css/73.styles.eab8b2ae.css" as="style"><link rel="preload" href="/solidus/assets/js/app.8a40fd93.js" as="script"><link rel="preload" href="/solidus/assets/js/40.18604395.js" as="script"><link rel="prefetch" href="/solidus/assets/js/37.b74e6c67.js"><link rel="prefetch" href="/solidus/assets/js/1.bc8aaa90.js"><link rel="prefetch" href="/solidus/assets/js/2.d4e88151.js"><link rel="prefetch" href="/solidus/assets/js/3.e88dfa7e.js"><link rel="prefetch" href="/solidus/assets/js/4.7b7ea6ef.js"><link rel="prefetch" href="/solidus/assets/js/5.8bb30487.js"><link rel="prefetch" href="/solidus/assets/js/6.6430c6fd.js"><link rel="prefetch" href="/solidus/assets/js/7.573fb1d2.js"><link rel="prefetch" href="/solidus/assets/js/8.9360dac4.js"><link rel="prefetch" href="/solidus/assets/js/9.bc0513d0.js"><link rel="prefetch" href="/solidus/assets/js/10.9de329d0.js"><link rel="prefetch" href="/solidus/assets/js/11.3ef794fe.js"><link rel="prefetch" href="/solidus/assets/js/12.a9f19247.js"><link rel="prefetch" href="/solidus/assets/js/13.10bdcfc3.js"><link rel="prefetch" href="/solidus/assets/js/14.baeb49cf.js"><link rel="prefetch" href="/solidus/assets/js/15.4d27d13f.js"><link rel="prefetch" href="/solidus/assets/js/16.4dbd3af2.js"><link rel="prefetch" href="/solidus/assets/js/17.96a840b0.js"><link rel="prefetch" href="/solidus/assets/js/18.7af603a9.js"><link rel="prefetch" href="/solidus/assets/js/19.944f2391.js"><link rel="prefetch" href="/solidus/assets/js/20.0d3a03ca.js"><link rel="prefetch" href="/solidus/assets/js/21.6f8a3623.js"><link rel="prefetch" href="/solidus/assets/js/22.1ab16961.js"><link rel="prefetch" href="/solidus/assets/js/23.c5a09552.js"><link rel="prefetch" href="/solidus/assets/js/24.01d33ebc.js"><link rel="prefetch" href="/solidus/assets/js/25.368e20d3.js"><link rel="prefetch" href="/solidus/assets/js/26.0ff243dc.js"><link rel="prefetch" href="/solidus/assets/js/27.379ef86c.js"><link rel="prefetch" href="/solidus/assets/js/28.b1d94d4e.js"><link rel="prefetch" href="/solidus/assets/js/29.a582c0f5.js"><link rel="prefetch" href="/solidus/assets/js/30.75b3694e.js"><link rel="prefetch" href="/solidus/assets/js/31.32737bfe.js"><link rel="prefetch" href="/solidus/assets/js/32.68e6e17c.js"><link rel="prefetch" href="/solidus/assets/js/33.1e8efaaa.js"><link rel="prefetch" href="/solidus/assets/js/34.349d8482.js"><link rel="prefetch" href="/solidus/assets/js/35.78fdbd6e.js"><link rel="prefetch" href="/solidus/assets/js/36.0b2759fa.js"><link rel="prefetch" href="/solidus/assets/js/0.594398bd.js"><link rel="prefetch" href="/solidus/assets/js/38.bccdd185.js"><link rel="prefetch" href="/solidus/assets/js/39.ad7f257e.js"><link rel="prefetch" href="/solidus/assets/js/41.0e64d55c.js"><link rel="prefetch" href="/solidus/assets/js/42.83301a40.js"><link rel="prefetch" href="/solidus/assets/js/43.f596cdc7.js"><link rel="prefetch" href="/solidus/assets/js/44.07f48a7c.js"><link rel="prefetch" href="/solidus/assets/js/45.a59da533.js"><link rel="prefetch" href="/solidus/assets/js/46.adca66b1.js"><link rel="prefetch" href="/solidus/assets/js/47.61b9b3b8.js"><link rel="prefetch" href="/solidus/assets/js/48.94da6411.js"><link rel="prefetch" href="/solidus/assets/js/49.045da191.js"><link rel="prefetch" href="/solidus/assets/js/50.4aa1c95a.js"><link rel="prefetch" href="/solidus/assets/js/51.3f25a7cb.js"><link rel="prefetch" href="/solidus/assets/js/52.7fc3e97e.js"><link rel="prefetch" href="/solidus/assets/js/53.478f3a20.js"><link rel="prefetch" href="/solidus/assets/js/54.bee46771.js"><link rel="prefetch" href="/solidus/assets/js/55.d22fc5aa.js"><link rel="prefetch" href="/solidus/assets/js/56.2779de7d.js"><link rel="prefetch" href="/solidus/assets/js/57.9229e917.js"><link rel="prefetch" href="/solidus/assets/js/58.53b44760.js"><link rel="prefetch" href="/solidus/assets/js/59.b4ab94d2.js"><link rel="prefetch" href="/solidus/assets/js/60.024d7dba.js"><link rel="prefetch" href="/solidus/assets/js/61.c0c81db2.js"><link rel="prefetch" href="/solidus/assets/js/62.9766010b.js"><link rel="prefetch" href="/solidus/assets/js/63.a22ac1c9.js"><link rel="prefetch" href="/solidus/assets/js/64.711f7334.js"><link rel="prefetch" href="/solidus/assets/js/65.0f534f00.js"><link rel="prefetch" href="/solidus/assets/js/66.e38c54e1.js"><link rel="prefetch" href="/solidus/assets/js/67.a395f431.js"><link rel="prefetch" href="/solidus/assets/js/68.f86e2d51.js"><link rel="prefetch" href="/solidus/assets/js/69.6f1fc43a.js"><link rel="prefetch" href="/solidus/assets/js/70.944af6a0.js"><link rel="prefetch" href="/solidus/assets/js/71.1f9a1de8.js"><link rel="prefetch" href="/solidus/assets/js/72.3e4d2c2a.js">
    <link rel="stylesheet" href="/solidus/assets/css/73.styles.eab8b2ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/solidus/" class="home-link router-link-active"><img src="/solidus/logo.svg" class="logo"><span class="site-name can-hide">
      Guidelines
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/solidus/" class="nav-link">Home</a></div><a href="https://github.com/solidusio/solidus" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/solidus/" class="nav-link">Home</a></div><a href="https://github.com/solidusio/solidus" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Preferences</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Locations</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Payments</span><span class="arrow up"></span></p><ul class="sidebar-group-items"><li><a href="/solidus/payments/overview.html" class="sidebar-link">Overview</a></li><li><a href="/solidus/payments/payments.html" class="active sidebar-link">Payments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/solidus/payments/payments.html#payment-identifiers" class="sidebar-link">Payment identifiers</a></li><li class="sidebar-sub-header"><a href="/solidus/payments/payments.html#response-codes" class="sidebar-link">Response codes</a></li><li class="sidebar-sub-header"><a href="/solidus/payments/payments.html#payment-states" class="sidebar-link">Payment states</a></li></ul></li><li><a href="/solidus/payments/payment-methods.html" class="sidebar-link">Payment methods</a></li><li><a href="/solidus/payments/payment-sources.html" class="sidebar-link">Payment sources</a></li><li><a href="/solidus/payments/payment_processing.html" class="sidebar-link">Payment Processing</a></li><li><a href="/solidus/payments/payment-service-providers.html" class="sidebar-link">Payment service providers</a></li><li><a href="/solidus/payments/custom_gateway.html" class="sidebar-link">Building a custom gateway</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Taxation</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Shipments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Calculators</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Assets</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Views</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Products and Variants</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Inventory</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Returns</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Promotions</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Adjustments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Orders</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Returns</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Users</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Upgrades</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Extensions</span><span class="arrow down"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="payments"><a href="#payments" aria-hidden="true" class="header-anchor">#</a> Payments</h1><p>The <code>Spree::Payment</code> model in Solidus tracks payments. A new payment is created
once the customer has submitted their payment details during checkout. Once a
payment's <code>state</code> is marked as <code>completed</code>, it counts against a <code>Spree::Order</code>'s
total.</p><p>Payments relate to a specific <code>Spree::Order</code>, as well as one of your available
<code>Spree::PaymentMethod</code>s and a payment source (which could be a
<code>Spree::CreditCard</code>, a <code>Spree::StoreCredit</code> or some other non-<code>Spree</code> model).</p><p><code>Spree::Payment</code> objects have the following attributes:</p><ul><li><code>amount</code>: The payment amount.</li><li><code>order_id</code>: The ID for the associated <code>Spree::Order</code>.</li><li><code>source_type</code> and <code>source_id</code>: The model being used as the payment source and
its ID. For example, <code>Spree::CreditCard</code>. See the <a href="/solidus/payments/payment-sources.html">Payment
sources</a> article for more information.</li><li><code>payment_method_id</code>: The ID for the associated <code>Spree::PaymentMethod</code>.</li><li><code>state</code>: The payment's current state. See <a href="#payment-states">Payment states</a>
for more information.</li><li><code>response_code</code>: A generalized response code or token sent by the payment
service provider. You should configure this based on the payment service
provider you are using. For example, this could be used to display a Stripe
transaction token in case it needs to be referenced later on.</li><li><code>avs_response</code>: The AVS response code sent by the payment service provider.
See <a href="#response-codes">Response codes</a> for more information.</li><li><code>number</code>: A unique number to identify the current payment. See <a href="#payment-identifiers">Payment
identifiers</a> for more information.</li><li><code>cvv_response_code</code> and <code>cvv_response_message</code>: The CVV2 response sent by the
payment service provider. See <a href="#response-codes">Response codes</a> for more
information.</li></ul><h2 id="payment-identifiers"><a href="#payment-identifiers" aria-hidden="true" class="header-anchor">#</a> Payment identifiers</h2><p>When a <code>Spree::Payment</code> is created, a unique, eight-character identifier is
generated for the <code>number</code> attribute. It should look something like this:
<code>2EYGNY8D</code>. This is used when sending the payment details to the [payment
service provider][payment-service-providers].</p><p>While some payment service providers may not require a payment identifier, other
services may require or recommend them. In the past, some services have
erroneously reported duplicate payments when not recording a payment identifier.</p><h2 id="response-codes"><a href="#response-codes" aria-hidden="true" class="header-anchor">#</a> Response codes</h2><p><code>Spree::Payment</code>s store AVS and CVV2 response codes that are sent back from the
payment service provider. These response codes help you classify payments as
risky, non-risky, or invalid. See <a href="https://developer.paypal.com/docs/classic/api/AVSResponseCodes/" target="_blank" rel="noopener noreferrer">PayPal's list of AVS and CVV response
codes</a> to learn more about what these codes mean.</p><h2 id="payment-states"><a href="#payment-states" aria-hidden="true" class="header-anchor">#</a> Payment states</h2><p>A <code>Spree::Payment</code>'s <code>state</code> attribute changes before and after it is sent to
the payment service provider. Here is an explanation for each potential state:</p><ul><li><code>checkout</code>: The <code>Spree::Order</code> is not yet complete.</li><li><code>processing</code>: The payment is being processed by the payment service provider.
This is a temporary state intended to prevent the double-submission of a
payment.</li><li><code>pending</code>: The payment service provider has processed the payment, but the
payment is not yet captured.</li><li><code>failed</code>: The payment was rejected by the payment service provider.</li><li><code>invalid</code>: The payment is invalid and needs to be reattempted.</li><li><code>void</code>: The payment should not be counted against the order.</li><li><code>completed</code>: The payment is completed.</li></ul><p>Note that only payments in the <code>completed</code> state count against the order total.</p><h3 id="payment-event-methods"><a href="#payment-event-methods" aria-hidden="true" class="header-anchor">#</a> Payment event methods</h3><p>The <code>Spree::Payment</code> model includes event methods you can use to transition from
state to state:</p><ul><li><code>started_processing</code></li><li><code>failure</code></li><li><code>pend</code></li><li><code>complete</code></li><li><code>void</code></li><li><code>invalidate</code></li></ul></div><div class="content edit-link"><a href="https://github.com/solidusio/solidus/edit/master/guides/payments/payments.md" target="_blank" rel="noopener noreferrer">Edit this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/solidus/payments/overview.html" class="prev">
          Overview
        </a></span><span class="next"><a href="/solidus/payments/payment-methods.html">
          Payment methods
        </a> →
      </span></p></div></div></div></div>
    <script src="/solidus/assets/js/40.18604395.js" defer></script><script src="/solidus/assets/js/app.8a40fd93.js" defer></script>
  </body>
</html>
