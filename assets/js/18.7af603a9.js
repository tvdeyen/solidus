(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{128:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[t._m(0),s("p",[t._v("This article provides context about creating custom shipping calculators in the\ncase that the provided calculators do not meet your store's needs.")]),t._m(1),s("p",[t._v("Before developing a custom calculator, you should make sure that the calculator\nyou need doesn't already exist in Solidus or one of its extensions.")]),s("p",[t._v("Solidus comes with a set of default calculators that account for typical\nshipping scenarios:")]),t._m(2),s("p",[t._v("If the calculators that come with Solidus are not enough for your needs, you\nmight want to use an extension like\n"),s("router-link",{attrs:{to:"solidus-active-shipping-extension.html"}},[s("code",[t._v("solidus_active_shipping")])]),t._v(" that provides additional\nAPI-based rate calculation functionality for common carriers like UPS, USPS, and\nFedEx. Alternatively, you could develop your own custom calculator.")],1),t._m(3),t._m(4),t._m(5),s("p",[t._v("Typically, a calculator uses the following order information:")]),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),t._m(13),t._m(14),s("p",[t._v("Your custom shipping calculator requires at least two methods:")]),t._m(15),s("p",[t._v("For example:")]),t._m(16),t._m(17),s("p",[t._v("Once you have created the logic for the new shipping calculator, you need to\nregister it so that administrators can create new shipping methods that use the\ncustom calculator.")]),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),s("p",[t._v("For more information about availability and filtering shipping methods, see the\n"),s("router-link",{attrs:{to:"shipping-method-filters.html"}},[t._v("Shipping method filters")]),t._v(" article.")],1),t._m(24),s("p",[t._v("In addition to providing relevant information about shipping addresses and\nproduct variants, you can use information about the product itself to inform a\ncalculator's results. A product's tax category or shipping category could be\nmeaningful information for shipping calculations. By default, each package\ncontains only items in the same shipping category.")]),s("p",[t._v('For example, you might want your calculator to handle your product with a\nshipping category of "Oversized" differently than it would a product with the\n"Default" shipping category.')])])},[function(){var t=this.$createElement,a=this._self._c||t;return a("h1",{attrs:{id:"custom-shipping-calculators"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-shipping-calculators","aria-hidden":"true"}},[this._v("#")]),this._v(" Custom shipping calculators")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"pre-configured-calculators"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pre-configured-calculators","aria-hidden":"true"}},[this._v("#")]),this._v(" Pre-configured calculators")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/calculator/shipping/flat_percent_item_total.rb",target:"_blank",rel:"noopener noreferrer"}},[this._v("Flat percent")])]),a("li",[a("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/calculator/shipping/flat_rate.rb",target:"_blank",rel:"noopener noreferrer"}},[this._v("Flat rate (per order)")])]),a("li",[a("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/calculator/shipping/per_item.rb",target:"_blank",rel:"noopener noreferrer"}},[this._v("Flat rate per package item")])]),a("li",[a("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/calculator/shipping/flexi_rate.rb",target:"_blank",rel:"noopener noreferrer"}},[this._v("Flexible rate per package item")])]),a("li",[a("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/calculator/shipping/price_sack.rb",target:"_blank",rel:"noopener noreferrer"}},[this._v("Price sack")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"custom-calculator-requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-calculator-requirements","aria-hidden":"true"}},[this._v("#")]),this._v(" Custom calculator requirements")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("A custom calculator should accept a "),a("code",[this._v("Spree::Stock::Package")]),this._v(" (a "),a("code",[this._v("package")]),this._v(") and\nreturn a cost.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("Use the "),a("code",[this._v("package.order")]),this._v(" method to access the current order's information, and\nthe "),a("code",[this._v("package.contents")]),this._v(" methods to access the current package's contents. As a\ndeveloper, you should always deal with the "),a("code",[this._v("package.contents")]),this._v(". Otherwise, you\nmay be quoting an entire order when you only want to quote one of many shipments\non an order.")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[t._v("The "),s("code",[t._v("Spree::Address")]),t._v(" used as the order's shipping address.")]),s("li",[t._v("The "),s("code",[t._v("Spree::LineItem")]),t._v(" objects associated with the order.")]),s("li",[t._v("The "),s("code",[t._v("Spree::Variant")]),t._v(" product information (such as the weight and dimensions)\nassociated with each line item in the order.")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("For an example of a typical calculator, we recommend reading the source code for\nSolidus's "),a("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/calculator/shipping/flat_rate.rb",target:"_blank",rel:"noopener noreferrer"}},[this._v("stock flat rate calculator")]),this._v(".")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("For a more complicated example of what is possible with custom calculators, see\nthe "),a("a",{attrs:{href:"https://github.com/solidusio-contrib/solidus_active_shipping/blob/master/app/models/spree/calculator/shipping/active_shipping/base.rb",target:"_blank",rel:"noopener noreferrer"}},[a("code",[this._v("solidus_active_shipping")]),this._v(" base calculator")]),this._v(". This\ncalculator collects enough information about an order to send to a carrier and\nget a rate quote back.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"inherit-from-the-spree-shippingcalculator-class"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#inherit-from-the-spree-shippingcalculator-class","aria-hidden":"true"}},[this._v("#")]),this._v(" Inherit from the "),a("code",[this._v("Spree::ShippingCalculator")]),this._v(" class")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("Your custom shipping calculator should inherit from the existing\n"),a("code",[this._v("Spree::ShippingCalculator")]),this._v(" class. We recommend following the same directory\nstructure that Spree models do, so your new calculator would be created at:")])},function(){var t=this.$createElement,a=this._self._c||t;return a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("/app/models/my_store/calculator/shipping/custom_shipping_calculator.rb\n")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("Then, follow the pattern of Spree's built-in calculators and inherit from\n"),a("code",[this._v("Spree::ShippingCalculator")]),this._v(":")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("pre",{pre:!0,attrs:{class:"language-ruby"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("MyStore")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Calculator")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("Shipping")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("CustomShippingCalculator")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("Spree")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("ShippingCalculator")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"required-methods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#required-methods","aria-hidden":"true"}},[this._v("#")]),this._v(" Required methods")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",[a("li",[this._v("A "),a("code",[this._v("self.description")]),this._v(" method that provides a name for the custom calculator.")]),a("li",[this._v("A "),a("code",[this._v("compute_package(package)")]),this._v(" that provides the return value for a package\nbeing shipped.")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("pre",{pre:!0,attrs:{class:"language-ruby"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("MyStore")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Calculator")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("Shipping")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("CustomShippingCalculator")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("Spree")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("ShippingCalculator")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("self")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("description\n      "),s("span",{attrs:{class:"token string"}},[t._v('"Custom Shipping Calculator"')]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("compute_package")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("package"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token number"}},[t._v("12.00")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"register-the-new-shipping-calculator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#register-the-new-shipping-calculator","aria-hidden":"true"}},[this._v("#")]),this._v(" Register the new shipping calculator")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("For example, you can register it in your "),a("code",[this._v("/config/application.rb")]),this._v(" initializer:")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("pre",{pre:!0,attrs:{class:"language-ruby"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("# /config/application.rb")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("MyStore")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Application")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("Rails")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("Application")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    initializer "),s("span",{attrs:{class:"token string"}},[t._v("'spree.register.calculators'")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("app"),s("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n      app"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("spree"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("calculators"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shipping_methods "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("MyStore")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("Calculator")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("Shipping")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("CustomShippingCalculator")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"calculator-availability"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#calculator-availability","aria-hidden":"true"}},[this._v("#")]),this._v(" Calculator availability")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("p",[t._v("By default, shipping calculators are always available to be used by shipping\nmethods. This is because the "),s("code",[t._v("available?")]),t._v(" method on the base\n"),s("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/calculator.rb",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Spree::Calculator")]),t._v(" class")]),t._v(" returns "),s("code",[t._v("true")]),t._v(" by default.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("You may want to make the calculator availability change depending on some aspect\nof the current order. To do this, you can override the "),a("code",[this._v("available?")]),this._v(" method in\nyour custom calculator:")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("pre",{pre:!0,attrs:{class:"language-ruby"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("MyStore")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Calculator")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("Shipping")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("CustomShippingCalculator")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{attrs:{class:"token constant"}},[t._v("Spree")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token constant"}},[t._v("ShippingCalculator")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" available"),s("span",{attrs:{class:"token operator"}},[t._v("?")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      order"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currency "),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"USD"')]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"use-additional-product-information"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#use-additional-product-information","aria-hidden":"true"}},[this._v("#")]),this._v(" Use additional product information")])}],!1,null,null,null);a.default=n.exports}}]);