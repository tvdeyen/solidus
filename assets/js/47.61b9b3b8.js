(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{85:function(e,t,a){"use strict";a.r(t);var r=a(0),o=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"update-orders"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#update-orders","aria-hidden":"true"}},[e._v("#")]),e._v(" Update orders")]),a("p",[e._v("You need to use the "),a("code",[e._v("recalculate")]),e._v(" method on a "),a("code",[e._v("Spree::Order")]),e._v(" to keep its total\nup-to-date.  Note that the total changes every time that line items and\nadjustments are added or modified. The "),a("code",[e._v("recalculate")]),e._v(" method calls out to the\n"),a("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/order_updater.rb",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Spree::OrderUpdater")]),e._v(" class")]),e._v(".")]),a("p",[e._v("For example, the "),a("code",[e._v("solidus_backend")]),e._v(" gem's\n"),a("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/backend/app/controllers/spree/admin/adjustments_controller.rb",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Spree::Admin::AdjustmentsController")])]),e._v(" uses the\n"),a("code",[e._v("recalculate")]),e._v(" method to update totals throughout the lifetime of an order:")]),a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[e._v("def")]),e._v(" update_totals\n  "),a("span",{attrs:{class:"token variable"}},[e._v("@order")]),a("span",{attrs:{class:"token punctuation"}},[e._v(".")]),e._v("reload"),a("span",{attrs:{class:"token punctuation"}},[e._v(".")]),e._v("recalculate\n"),a("span",{attrs:{class:"token keyword"}},[e._v("end")]),e._v("\n")])]),a("p",[e._v("The "),a("code",[e._v("update_totals")]),e._v(" method is called every time that adjustments are created,\ndestroyed, and updated.")]),a("p",[e._v("Whenever you change the code that touches the values of a "),a("code",[e._v("Spree::Order")]),e._v(", use\nthe "),a("code",[e._v("recalculate")]),e._v(" method to ensure your order's totals are accurate. For\nexample, you would want to call the "),a("code",[e._v("recalculate")]),e._v(" method in the following\nscenarios:")]),a("ul",[a("li",[e._v("Whenever you create or modify a "),a("code",[e._v("Spree::Payment")]),e._v(" that changes the order's\n"),a("code",[e._v("payment_state")]),e._v(" value.")]),a("li",[e._v("Whenever a "),a("code",[e._v("Spree:LineItem")]),e._v(" on the order has a price change.")])])])}],!1,null,null,null);t.default=o.exports}}]);