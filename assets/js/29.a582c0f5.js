(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{67:function(t,e,o){"use strict";o.r(e);var s=o(0),n=Object(s.a)({},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"content"},[t._m(0),o("p",[t._v("Solidus's promotions system allows stores to give discounts to customers.")]),o("p",[t._v("Promotions might be discounts on orders, line items, or shipping charges. The\npromotions system provides a set of handlers, rules, and actions that work\ntogether to provide flexible discounts in any scenario.")]),o("p",[t._v("To account for all of the ways a discount may be applied, the promotions system\nhas many complex moving parts.")]),t._m(1),t._m(2),o("p",[t._v("The following sections summarize the main parts of Solidus's promotions system.")]),t._m(3),t._m(4),o("p",[t._v("Take note of the following promotion attributes:")]),t._m(5),t._m(6),t._m(7),t._m(8),o("p",[t._v("Subclasses of the "),o("code",[t._v("Spree::PromotionHandler")]),t._v(" model activate a promotion if the\npromotion is "),o("a",{attrs:{href:"#eligibility"}},[t._v("eligible")]),t._v(" to be applied. There are "),o("code",[t._v("Cart")]),t._v(", "),o("code",[t._v("Coupon")]),t._v(",\n"),o("code",[t._v("Page")]),t._v(", and "),o("code",[t._v("Shipping")]),t._v(" subclasses, each one used for a different promotion\nactivation method. For more information, see the "),o("router-link",{attrs:{to:"promotion-handlers.html"}},[t._v("Promotion\nhandlers")]),t._v(" article.")],1),t._m(9),t._m(10),t._m(11),t._m(12),o("p",[t._v("An example of a typical promotion rule would be a minimum order total of $75\nUSD or that a specific product is in the cart at checkout.")]),o("p",[t._v("For a list of available rule types and more information, see the\n"),o("router-link",{attrs:{to:"promotion-rules.html"}},[t._v("Promotion rules")]),t._v(" article.")],1),t._m(13),t._m(14),o("p",[t._v("Typically, a promotion action could be free shipping or a fixed percentage\ndiscount.")]),t._m(15),t._m(16),t._m(17),t._m(18),o("p",[t._v("Note that shipments and taxes can also create adjustments. See the adjustments\ndocumentation for more information.")]),t._m(19),t._m(20),t._m(21),o("p",[t._v("If all of these checks pass, then the promotion is eligible.")]),t._m(22),t._m(23),o("p",[t._v("Note that promotions without rules are eligible by default.")]),t._m(24),t._m(25),o("p",[t._v("This section provides a high-level view of the promotion system in action. For\nthe sake of this example, the store administrator is creating a free shipping\npromotion for orders over $100 USD.")]),t._m(26),t._m(27),t._m(28),t._m(29),o("p",[t._v("Different types of promotions would change the customer's experience of\npromotion activation. For example, the customer might be required to enter a\npromotion code to activate some promotions, while a another promotion could be\napplied automatically.")]),o("p",[t._v('In this case, because the administrator used the "Apply to all orders"\nactivation method, the promotion is applied automatically:')]),t._m(30)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"overview-of-promotions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview-of-promotions","aria-hidden":"true"}},[this._v("#")]),this._v(" Overview of promotions")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("We recommend that you start up a Solidus store on your local machine and see the\nbuilt-in promotions functionality yourself, as store administrators have a\nflexible promotions system available by default\n("),e("a",{attrs:{href:"http://localhost:3000/admin/promotions",target:"_blank",rel:"noopener noreferrer"}},[e("code",[this._v("http://localhost:3000/admin/promotions")])]),this._v("). Here,\nadministrators can add promotions and create complex strings of promotion rules\nand actions if necessary.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"promotion-architecture"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promotion-architecture","aria-hidden":"true"}},[this._v("#")]),this._v(" Promotion architecture")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"promotion-model"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promotion-model","aria-hidden":"true"}},[this._v("#")]),this._v(" Promotion model")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("Spree::Promotion")]),this._v(" model defines essential information about a promotion.\nThis includes the promotion's name, description, and whether the promotion\nshould be active or not.")])},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("ul",[o("li",[o("code",[t._v("name")]),t._v(": The name for the promotion. This is displayed to customers as an\nadjustment label when it is applied.")]),o("li",[o("code",[t._v("description")]),t._v(": An administrative description for the promotion.")]),o("li",[o("code",[t._v("usage_limit")]),t._v(": How many times the promotion can be used before becoming\ninactive.")]),o("li",[o("code",[t._v("starts_at")]),t._v(" and "),o("code",[t._v("expires_at")]),t._v(": Optional date values for the start and end of\nthe promotion.")]),o("li",[o("code",[t._v("match_policy")]),t._v(": When set to "),o("code",[t._v("all")]),t._v(", all promotion rules must be met in order\nfor the promotion to be eligible. When set to "),o("code",[t._v("any")]),t._v(", just one of the\n"),o("a",{attrs:{href:"#promotion-rules"}},[t._v("promotion rules")]),t._v(" must be met.")]),o("li",[o("code",[t._v("path")]),t._v(": If the promotion is activated when the customer visits a URL, this\nvalue is the path for the URL.")]),o("li",[o("code",[t._v("per_code_usage_limit")]),t._v(": Specifies how many times each code can be used before\nit becomes inactive.")]),o("li",[o("code",[t._v("apply_automatically")]),t._v(": If "),o("code",[t._v("true")]),t._v(", the promotion is activated and applied\nautomatically once all of the "),o("a",{attrs:{href:"#eligibility"}},[t._v("eligibility checks")]),t._v(" have passed.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Note that you can access promotion information using the "),e("code",[this._v("promotion")]),this._v(" method on\nits associated "),e("code",[this._v("Spree::PromotionRule")]),this._v(" and "),e("code",[this._v("Spree::PromotionAction")]),this._v(" objects:")])},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("pre",{pre:!0,attrs:{class:"language-ruby"}},[o("code",[o("span",{attrs:{class:"token constant"}},[t._v("Spree")]),o("span",{attrs:{class:"token punctuation"}},[t._v(":")]),o("span",{attrs:{class:"token punctuation"}},[t._v(":")]),o("span",{attrs:{class:"token constant"}},[t._v("PromotionAction")]),o("span",{attrs:{class:"token punctuation"}},[t._v(".")]),o("span",{attrs:{class:"token function"}},[t._v("find")]),o("span",{attrs:{class:"token punctuation"}},[t._v("(")]),o("span",{attrs:{class:"token number"}},[t._v("1")]),o("span",{attrs:{class:"token punctuation"}},[t._v(")")]),o("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("promotion\n")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"promotion-handlers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promotion-handlers","aria-hidden":"true"}},[this._v("#")]),this._v(" Promotion handlers")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Once a promotion handler activates a promotion, and all of the eligibility\nchecks pass, the "),e("code",[this._v("Spree::PromotionAction")]),this._v(" can be applied to the applicable\nshipment, order, or line item.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"promotion-rules"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promotion-rules","aria-hidden":"true"}},[this._v("#")]),this._v(" Promotion rules")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("Spree::PromotionRule")]),this._v(" model sets a rule that determines whether a promotion\nis eligible to be applied. Promotions may have no rules or many different rules.")])},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("p",[t._v("By default, "),o("code",[t._v("Spree::Promotion")]),t._v("s have a "),o("code",[t._v("match_policy")]),t._v(" value of "),o("code",[t._v("all")]),t._v(", meaning\nthat all of the promotion rules on a promotion must be met before the promotion\nis eligible. However, this can be changed to "),o("code",[t._v("any")]),t._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"promotion-actions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promotion-actions","aria-hidden":"true"}},[this._v("#")]),this._v(" Promotion actions")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("Spree::PromotionAction")]),this._v(" model defines an action that should occur if the\npromotion is activated and eligible to be applied. There can be multiple\npromotion actions on a promotion.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("A promotion action calculates the discount amount and creates a\n"),e("code",[this._v("Spree::Adjustment")]),this._v(" for the promotion. The adjustment then adjusts the price of\nan order, line item, or shipment.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"promotion-adjustments"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promotion-adjustments","aria-hidden":"true"}},[this._v("#")]),this._v(" Promotion adjustments")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Finally, the "),e("code",[this._v("Spree::Adjustment")]),this._v(" model defines the discount amount that is\napplied. Each adjustment is created by a "),e("code",[this._v("Spree::PromotionAction")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Every time that the promotion adjustment needs to be recalculated, the\n"),e("code",[this._v("Spree::PromotionRules")]),this._v(" are re-checked to ensure the promotion is still\neligible.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"eligibility"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#eligibility","aria-hidden":"true"}},[this._v("#")]),this._v(" Eligibility")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Spree::Promotion")]),this._v("'s performs a number of checks to determine whether a\npromotion is eligible to be applied.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("First, it checks that the promotion is active, that its usage limit has not been\nreached, that its promotion code usage limit has not be reached, and that all of\nthe products are promotable products. Finally, it checks the\n"),e("code",[this._v("Spree::PromotionRule")]),this._v("s.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("See the "),e("code",[this._v("eligible?")]),this._v(" method defined in the "),e("a",{attrs:{href:"https://github.com/solidusio/solidus/blob/master/core/app/models/spree/promotion.rb",target:"_blank",rel:"noopener noreferrer"}},[this._v("Spree::Promotion\nmodel")]),this._v(":")])},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("pre",{pre:!0,attrs:{class:"language-ruby"}},[o("code",[o("span",{attrs:{class:"token comment"}},[t._v("# models/spree/promotion.rb : line 123")]),t._v("\n"),o("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" eligible"),o("span",{attrs:{class:"token operator"}},[t._v("?")]),o("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("promotable"),o("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" promotion_code"),o("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("nil")]),o("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),o("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("false")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" inactive"),o("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v("\n  "),o("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("false")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" usage_limit_exceeded"),o("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v("\n  "),o("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("false")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" promotion_code "),o("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" promotion_code"),o("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("usage_limit_exceeded"),o("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v("\n  "),o("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("false")]),t._v(" "),o("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" blacklisted"),o("span",{attrs:{class:"token operator"}},[t._v("?")]),o("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("promotable"),o("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),o("span",{attrs:{class:"token operator"}},[t._v("!")]),o("span",{attrs:{class:"token operator"}},[t._v("!")]),o("span",{attrs:{class:"token function"}},[t._v("eligible_rules")]),o("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("promotable"),o("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),o("span",{attrs:{class:"token punctuation"}},[t._v("{")]),o("span",{attrs:{class:"token punctuation"}},[t._v("}")]),o("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),o("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Once the promotion is confirmed eligible, the promotion can be activated through\nthe relevant "),e("code",[this._v("Spree::PromotionHandler")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"promotion-flow"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promotion-flow","aria-hidden":"true"}},[this._v("#")]),this._v(" Promotion flow")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("The administrator creates a "),e("code",[this._v("Spree::Promotion")]),this._v(" from the Solidus backend.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("They create a name, description, and optional category for the promotion.")]),e("li",[this._v("They choose not to set a usage limit for the promotion.")]),e("li",[this._v("They choose not to set a start or end date for the promotion.")]),e("li",[this._v('They choose the "Apply to all orders" activation method. Alternatively, they\ncould have chosen to apply promotions via a promotion code or a URL.')])])},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("ol",{attrs:{start:"2"}},[o("li",[t._v("The administrator creates "),o("code",[t._v("Spree::PromotionRule")]),t._v("s for the promotion.\n"),o("ul",[o("li",[t._v('In this case, they use the rule type "Item Total"\n('),o("code",[t._v("Spree::Promotion::Rules::ItemTotal")]),t._v(") and set the rule so that the\norder must be greater than $100 USD.")])])]),o("li",[t._v("The administrator creates "),o("code",[t._v("Spree::PromotionAction")]),t._v("s for the promotion.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v('They use promotion action type "Free shipping", which uses the\n'),e("code",[this._v("Spree::Promotion::Actions::Shipping")]),this._v(' model. In this case, the only\navailable action is "Makes all shipments for the order free".')]),e("li",[this._v("Because the promotion action requires a shipment, the\n"),e("code",[this._v("Spree::PromotionHandler::Shipping")]),this._v(" will be used when it is time to activate\nthe promotion.")])])},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("ol",[o("li",[t._v("The customer adds items to their cart. The "),o("code",[t._v("Spree::Order")]),t._v(" total is greater\nthan $100 USD.")]),o("li",[t._v("The customer begins the checkout process.")]),o("li",[t._v("The customer enters their shipping information.")]),o("li",[t._v("The "),o("code",[t._v("Spree::PromotionHandler::Shipping")]),t._v(" handler checks that the\n"),o("code",[t._v("Spree::PromotionRule")]),t._v("s are met. Because the order total is\ngreater than $100 USD, the promotion is eligible.")]),o("li",[t._v("The "),o("code",[t._v("Spree::PromotionHandler::Shipping")]),t._v(" activates the promotion.")]),o("li",[t._v("The "),o("code",[t._v("Spree::PromotionAction")]),t._v(" associated with the promotion is computed and\napplied as a "),o("code",[t._v("Spree::Adjustment")]),t._v(" that negates the order's shipping charges..\nThe customer's shipping is now free.")]),o("li",[t._v("The customer completes the checkout process.")])])}],!1,null,null,null);e.default=n.exports}}]);