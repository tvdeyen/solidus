(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{99:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"testing-extensions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#testing-extensions","aria-hidden":"true"}},[s._v("#")]),s._v(" Testing extensions")]),a("p",[s._v("Solidus extensions should work with and be tested against multiple versions of\nSolidus. This article outlines how Solidus and "),a("a",{attrs:{href:"https://github.com/solidusio-contrib",target:"_blank",rel:"noopener noreferrer"}},[s._v("the "),a("code",[s._v("solidusio-contrib")]),s._v("\nextensions")]),s._v(" are tested. Consider it a model as you develop your own\nSolidus extensions.")]),a("h2",{attrs:{id:"travisci"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#travisci","aria-hidden":"true"}},[s._v("#")]),s._v(" TravisCI")]),a("p",[s._v("We usually test our extensions on TravisCI and make use of their "),a("a",{attrs:{href:"https://docs.travis-ci.com/user/customizing-the-build/#Build-Matrix",target:"_blank",rel:"noopener noreferrer"}},[s._v("build matrix\nfeature")]),s._v(" to test across multiple Solidus versions. We also test\nagainst multiple databases: MySQL and PostgreSQL.")]),a("p",[s._v("Here's an example "),a("code",[s._v(".travis.yml")]),s._v(" testing versions 1.4 through 2.1 and the\n"),a("code",[s._v("master")]),s._v(" branch:")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[s._v("language")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ruby\n"),a("span",{attrs:{class:"token key atrule"}},[s._v("rvm")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 2.3.1\n"),a("span",{attrs:{class:"token key atrule"}},[s._v("env")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[s._v("matrix")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SOLIDUS_BRANCH=v1.4 DB=postgres\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SOLIDUS_BRANCH=v2.0 DB=postgres\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SOLIDUS_BRANCH=v2.1 DB=postgres\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SOLIDUS_BRANCH=master DB=postgres\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SOLIDUS_BRANCH=v1.4 DB=mysql\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SOLIDUS_BRANCH=v2.0 DB=mysql\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SOLIDUS_BRANCH=v2.1 DB=mysql\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SOLIDUS_BRANCH=master DB=mysql\n")])]),a("h2",{attrs:{id:"gemfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gemfile","aria-hidden":"true"}},[s._v("#")]),s._v(" Gemfile")]),a("p",[s._v("To use the versions of Solidus specified from the TravisCI build matrix, we need\nto use those environment variables in the "),a("code",[s._v("Gemfile")]),s._v(". Here's an example:")]),a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("source "),a("span",{attrs:{class:"token string"}},[s._v('"https://rubygems.org"')]),s._v("\n\nbranch "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("ENV")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("fetch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'SOLIDUS_BRANCH'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'master'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ngem "),a("span",{attrs:{class:"token string"}},[s._v('"solidus"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" github"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"solidusio/solidus"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" branch"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" branch\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" branch "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'master'")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" branch "),a("span",{attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"v2.0"')]),s._v("\n  gem "),a("span",{attrs:{class:"token string"}},[s._v('"rails-controller-testing"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" group"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token symbol"}},[s._v(":test")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  gem "),a("span",{attrs:{class:"token string"}},[s._v('"rails"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'~> 4.2.7'")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("# workaround for bundler resolution issue")]),s._v("\n  gem "),a("span",{attrs:{class:"token string"}},[s._v('"rails_test_params_backport"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" group"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token symbol"}},[s._v(":test")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\ngem "),a("span",{attrs:{class:"token string"}},[s._v("'pg'")]),s._v("\ngem "),a("span",{attrs:{class:"token string"}},[s._v("'mysql2'")]),s._v("\n\ngemspec\n")])]),a("h2",{attrs:{id:"migrations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migrations","aria-hidden":"true"}},[s._v("#")]),s._v(" Migrations")]),a("p",[s._v("Directly inheriting from "),a("code",[s._v("ActiveRecord::Migration")]),s._v(" is deprecated in Rails 5.0.\nStarting in 5.1, this is an error.")]),a("p",[s._v("To be able to support both Rails 5.1 and Rails 4.2 from the same extension, we\nuse a helper from the "),a("a",{attrs:{href:"https://github.com/solidusio/solidus_support",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("solidus_support")])]),s._v(" gem.")]),a("p",[s._v("Here is the processing for using the helper:")]),a("ol",[a("li",[s._v("Add a dependency on "),a("code",[s._v("solidus_support")]),s._v(" in the "),a("code",[s._v(".gemspec")]),s._v(".")])]),a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("# your_gem.gemspec")]),s._v("\ns"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_dependency "),a("span",{attrs:{class:"token string"}},[s._v("'solidus_core'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token string"}},[s._v("'>= 1.1'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'< 3'")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ns"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_dependency "),a("span",{attrs:{class:"token string"}},[s._v("'solidus_support'")]),s._v("\n")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("Require "),a("code",[s._v("solidus_support")]),s._v(" from the gem's "),a("code",[s._v("/lib/your_gem.rb")]),s._v(" file.")])]),a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("# /lib/your_gem.rb")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'solidus_core'")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'solidus_support'")]),s._v("\n")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("Replace all occurrences of "),a("code",[s._v("ActiveRecord::Migration")]),s._v(" in the gem. This would\nbe in all of your "),a("code",[s._v("db/migrate/*")]),s._v(" migration files.")])]),a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("MyAwesomeMigration")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("SolidusSupport")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token constant"}},[s._v("Migration")]),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("4.2")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),a("p",[s._v("You can replace all of the "),a("code",[s._v("ActiveRecord::Migration")]),s._v(" occurrences automatically\nwith "),a("code",[s._v("sed")]),s._v(":")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{attrs:{class:"token string"}},[s._v("'s/ActiveRecord::Migration/SolidusSupport::Migration[4.2]/'")]),s._v(" db/migrate/*.rb\n")])]),a("h2",{attrs:{id:"extensions-solidus-io"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#extensions-solidus-io","aria-hidden":"true"}},[s._v("#")]),s._v(" extensions.solidus.io")]),a("p",[s._v("You can see a list of Solidus extensions and their test suite statuses at\n"),a("a",{attrs:{href:"http://extensions.solidus.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("extensions.solidus.io")]),s._v(".")]),a("p",[s._v("If you'd like to have your extension added, "),a("a",{attrs:{href:"http://slack.solidus.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("join the Solidus Slack team")]),s._v("\nlet us know in the "),a("a",{attrs:{href:"https://solidusio.slack.com/messages/solidus",target:"_blank",rel:"noopener noreferrer"}},[s._v("#solidus channel")]),s._v(".")]),a("h2",{attrs:{id:"rails-5-request-specs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rails-5-request-specs","aria-hidden":"true"}},[s._v("#")]),s._v(" Rails 5 request specs")]),a("p",[s._v("In Rails 5, the syntax for making requests in tests has changed:")]),a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("# Pre-Rails 5")]),s._v("\nget "),a("span",{attrs:{class:"token symbol"}},[s._v(":users")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("id"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'123'")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" user_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("# Rails 5")]),s._v("\nget "),a("span",{attrs:{class:"token symbol"}},[s._v(":users")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" id"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'123'")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" session"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" user_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("To allow both of these in a test suite side by side, we make use of the\n"),a("a",{attrs:{href:"https://github.com/zendesk/rails_test_params_backport",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("rails_test_params_backport")])]),s._v(" gem.")]),a("p",[s._v("This can be fixed automatically using the\n"),a("a",{attrs:{href:"https://github.com/tjgrathwell/rails5-spec-converter",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("rails5-spec-converter")])]),s._v(" gem.")])])}],!1,null,null,null);t.default=e.exports}}]);