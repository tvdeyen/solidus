<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guidelines | Overview of promotions</title>
    <meta name="description" content="Developer Guides for Solidus">
    <link rel="shortcut icon" href="/solidus/favicon.ico">
  <link rel="apple-touch-icon" href="/solidus/apple-touch-icon.png">
    
    <link rel="preload" href="/solidus/assets/css/73.styles.eab8b2ae.css" as="style"><link rel="preload" href="/solidus/assets/js/app.8a40fd93.js" as="script"><link rel="preload" href="/solidus/assets/js/29.a582c0f5.js" as="script"><link rel="prefetch" href="/solidus/assets/js/37.b74e6c67.js"><link rel="prefetch" href="/solidus/assets/js/1.bc8aaa90.js"><link rel="prefetch" href="/solidus/assets/js/2.d4e88151.js"><link rel="prefetch" href="/solidus/assets/js/3.e88dfa7e.js"><link rel="prefetch" href="/solidus/assets/js/4.7b7ea6ef.js"><link rel="prefetch" href="/solidus/assets/js/5.8bb30487.js"><link rel="prefetch" href="/solidus/assets/js/6.6430c6fd.js"><link rel="prefetch" href="/solidus/assets/js/7.573fb1d2.js"><link rel="prefetch" href="/solidus/assets/js/8.9360dac4.js"><link rel="prefetch" href="/solidus/assets/js/9.bc0513d0.js"><link rel="prefetch" href="/solidus/assets/js/10.9de329d0.js"><link rel="prefetch" href="/solidus/assets/js/11.3ef794fe.js"><link rel="prefetch" href="/solidus/assets/js/12.a9f19247.js"><link rel="prefetch" href="/solidus/assets/js/13.10bdcfc3.js"><link rel="prefetch" href="/solidus/assets/js/14.baeb49cf.js"><link rel="prefetch" href="/solidus/assets/js/15.4d27d13f.js"><link rel="prefetch" href="/solidus/assets/js/16.4dbd3af2.js"><link rel="prefetch" href="/solidus/assets/js/17.96a840b0.js"><link rel="prefetch" href="/solidus/assets/js/18.7af603a9.js"><link rel="prefetch" href="/solidus/assets/js/19.944f2391.js"><link rel="prefetch" href="/solidus/assets/js/20.0d3a03ca.js"><link rel="prefetch" href="/solidus/assets/js/21.6f8a3623.js"><link rel="prefetch" href="/solidus/assets/js/22.1ab16961.js"><link rel="prefetch" href="/solidus/assets/js/23.c5a09552.js"><link rel="prefetch" href="/solidus/assets/js/24.01d33ebc.js"><link rel="prefetch" href="/solidus/assets/js/25.368e20d3.js"><link rel="prefetch" href="/solidus/assets/js/26.0ff243dc.js"><link rel="prefetch" href="/solidus/assets/js/27.379ef86c.js"><link rel="prefetch" href="/solidus/assets/js/28.b1d94d4e.js"><link rel="prefetch" href="/solidus/assets/js/30.75b3694e.js"><link rel="prefetch" href="/solidus/assets/js/31.32737bfe.js"><link rel="prefetch" href="/solidus/assets/js/32.68e6e17c.js"><link rel="prefetch" href="/solidus/assets/js/33.1e8efaaa.js"><link rel="prefetch" href="/solidus/assets/js/34.349d8482.js"><link rel="prefetch" href="/solidus/assets/js/35.78fdbd6e.js"><link rel="prefetch" href="/solidus/assets/js/36.0b2759fa.js"><link rel="prefetch" href="/solidus/assets/js/0.594398bd.js"><link rel="prefetch" href="/solidus/assets/js/38.bccdd185.js"><link rel="prefetch" href="/solidus/assets/js/39.ad7f257e.js"><link rel="prefetch" href="/solidus/assets/js/40.18604395.js"><link rel="prefetch" href="/solidus/assets/js/41.0e64d55c.js"><link rel="prefetch" href="/solidus/assets/js/42.83301a40.js"><link rel="prefetch" href="/solidus/assets/js/43.f596cdc7.js"><link rel="prefetch" href="/solidus/assets/js/44.07f48a7c.js"><link rel="prefetch" href="/solidus/assets/js/45.a59da533.js"><link rel="prefetch" href="/solidus/assets/js/46.adca66b1.js"><link rel="prefetch" href="/solidus/assets/js/47.61b9b3b8.js"><link rel="prefetch" href="/solidus/assets/js/48.94da6411.js"><link rel="prefetch" href="/solidus/assets/js/49.045da191.js"><link rel="prefetch" href="/solidus/assets/js/50.4aa1c95a.js"><link rel="prefetch" href="/solidus/assets/js/51.3f25a7cb.js"><link rel="prefetch" href="/solidus/assets/js/52.7fc3e97e.js"><link rel="prefetch" href="/solidus/assets/js/53.478f3a20.js"><link rel="prefetch" href="/solidus/assets/js/54.bee46771.js"><link rel="prefetch" href="/solidus/assets/js/55.d22fc5aa.js"><link rel="prefetch" href="/solidus/assets/js/56.2779de7d.js"><link rel="prefetch" href="/solidus/assets/js/57.9229e917.js"><link rel="prefetch" href="/solidus/assets/js/58.53b44760.js"><link rel="prefetch" href="/solidus/assets/js/59.b4ab94d2.js"><link rel="prefetch" href="/solidus/assets/js/60.024d7dba.js"><link rel="prefetch" href="/solidus/assets/js/61.c0c81db2.js"><link rel="prefetch" href="/solidus/assets/js/62.9766010b.js"><link rel="prefetch" href="/solidus/assets/js/63.a22ac1c9.js"><link rel="prefetch" href="/solidus/assets/js/64.711f7334.js"><link rel="prefetch" href="/solidus/assets/js/65.0f534f00.js"><link rel="prefetch" href="/solidus/assets/js/66.e38c54e1.js"><link rel="prefetch" href="/solidus/assets/js/67.a395f431.js"><link rel="prefetch" href="/solidus/assets/js/68.f86e2d51.js"><link rel="prefetch" href="/solidus/assets/js/69.6f1fc43a.js"><link rel="prefetch" href="/solidus/assets/js/70.944af6a0.js"><link rel="prefetch" href="/solidus/assets/js/71.1f9a1de8.js"><link rel="prefetch" href="/solidus/assets/js/72.3e4d2c2a.js">
    <link rel="stylesheet" href="/solidus/assets/css/73.styles.eab8b2ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/solidus/" class="home-link router-link-active"><img src="/solidus/logo.svg" class="logo"><span class="site-name can-hide">
      Guidelines
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/solidus/" class="nav-link">Home</a></div><a href="https://github.com/solidusio/solidus" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/solidus/" class="nav-link">Home</a></div><a href="https://github.com/solidusio/solidus" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Preferences</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Locations</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Payments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Taxation</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Shipments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Calculators</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Assets</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Views</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Products and Variants</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Inventory</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Returns</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Promotions</span><span class="arrow up"></span></p><ul class="sidebar-group-items"><li><a href="/solidus/promotions/overview.html" class="active sidebar-link">Overview of promotions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/solidus/promotions/overview.html#promotion-architecture" class="sidebar-link">Promotion architecture</a></li><li class="sidebar-sub-header"><a href="/solidus/promotions/overview.html#eligibility" class="sidebar-link">Eligibility</a></li><li class="sidebar-sub-header"><a href="/solidus/promotions/overview.html#promotion-flow" class="sidebar-link">Promotion flow</a></li></ul></li><li><a href="/solidus/promotions/promotion-rules.html" class="sidebar-link">Promotion rules</a></li><li><a href="/solidus/promotions/promotion-actions.html" class="sidebar-link">Promotion actions</a></li><li><a href="/solidus/promotions/promotion-handlers.html" class="sidebar-link">Promotion handlers</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Adjustments</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Orders</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Returns</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Users</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Upgrades</span><span class="arrow down"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Extensions</span><span class="arrow down"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="overview-of-promotions"><a href="#overview-of-promotions" aria-hidden="true" class="header-anchor">#</a> Overview of promotions</h1><p>Solidus's promotions system allows stores to give discounts to customers.</p><p>Promotions might be discounts on orders, line items, or shipping charges. The
promotions system provides a set of handlers, rules, and actions that work
together to provide flexible discounts in any scenario.</p><p>To account for all of the ways a discount may be applied, the promotions system
has many complex moving parts.</p><p>We recommend that you start up a Solidus store on your local machine and see the
built-in promotions functionality yourself, as store administrators have a
flexible promotions system available by default
(<a href="http://localhost:3000/admin/promotions" target="_blank" rel="noopener noreferrer"><code>http://localhost:3000/admin/promotions</code></a>). Here,
administrators can add promotions and create complex strings of promotion rules
and actions if necessary.</p><h2 id="promotion-architecture"><a href="#promotion-architecture" aria-hidden="true" class="header-anchor">#</a> Promotion architecture</h2><p>The following sections summarize the main parts of Solidus's promotions system.</p><h3 id="promotion-model"><a href="#promotion-model" aria-hidden="true" class="header-anchor">#</a> Promotion model</h3><p>The <code>Spree::Promotion</code> model defines essential information about a promotion.
This includes the promotion's name, description, and whether the promotion
should be active or not.</p><p>Take note of the following promotion attributes:</p><ul><li><code>name</code>: The name for the promotion. This is displayed to customers as an
adjustment label when it is applied.</li><li><code>description</code>: An administrative description for the promotion.</li><li><code>usage_limit</code>: How many times the promotion can be used before becoming
inactive.</li><li><code>starts_at</code> and <code>expires_at</code>: Optional date values for the start and end of
the promotion.</li><li><code>match_policy</code>: When set to <code>all</code>, all promotion rules must be met in order
for the promotion to be eligible. When set to <code>any</code>, just one of the
<a href="#promotion-rules">promotion rules</a> must be met.</li><li><code>path</code>: If the promotion is activated when the customer visits a URL, this
value is the path for the URL.</li><li><code>per_code_usage_limit</code>: Specifies how many times each code can be used before
it becomes inactive.</li><li><code>apply_automatically</code>: If <code>true</code>, the promotion is activated and applied
automatically once all of the <a href="#eligibility">eligibility checks</a> have passed.</li></ul><p>Note that you can access promotion information using the <code>promotion</code> method on
its associated <code>Spree::PromotionRule</code> and <code>Spree::PromotionAction</code> objects:</p><pre class="language-ruby"><code><span class="token constant">Spree</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PromotionAction</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promotion
</code></pre><h3 id="promotion-handlers"><a href="#promotion-handlers" aria-hidden="true" class="header-anchor">#</a> Promotion handlers</h3><p>Subclasses of the <code>Spree::PromotionHandler</code> model activate a promotion if the
promotion is <a href="#eligibility">eligible</a> to be applied. There are <code>Cart</code>, <code>Coupon</code>,
<code>Page</code>, and <code>Shipping</code> subclasses, each one used for a different promotion
activation method. For more information, see the <a href="/solidus/promotions/promotion-handlers.html">Promotion
handlers</a> article.</p><p>Once a promotion handler activates a promotion, and all of the eligibility
checks pass, the <code>Spree::PromotionAction</code> can be applied to the applicable
shipment, order, or line item.</p><h3 id="promotion-rules"><a href="#promotion-rules" aria-hidden="true" class="header-anchor">#</a> Promotion rules</h3><p>The <code>Spree::PromotionRule</code> model sets a rule that determines whether a promotion
is eligible to be applied. Promotions may have no rules or many different rules.</p><p>By default, <code>Spree::Promotion</code>s have a <code>match_policy</code> value of <code>all</code>, meaning
that all of the promotion rules on a promotion must be met before the promotion
is eligible. However, this can be changed to <code>any</code>.</p><p>An example of a typical promotion rule would be a minimum order total of $75
USD or that a specific product is in the cart at checkout.</p><p>For a list of available rule types and more information, see the
<a href="/solidus/promotions/promotion-rules.html">Promotion rules</a> article.</p><h3 id="promotion-actions"><a href="#promotion-actions" aria-hidden="true" class="header-anchor">#</a> Promotion actions</h3><p>The <code>Spree::PromotionAction</code> model defines an action that should occur if the
promotion is activated and eligible to be applied. There can be multiple
promotion actions on a promotion.</p><p>Typically, a promotion action could be free shipping or a fixed percentage
discount.</p><p>A promotion action calculates the discount amount and creates a
<code>Spree::Adjustment</code> for the promotion. The adjustment then adjusts the price of
an order, line item, or shipment.</p><h3 id="promotion-adjustments"><a href="#promotion-adjustments" aria-hidden="true" class="header-anchor">#</a> Promotion adjustments</h3><p>Finally, the <code>Spree::Adjustment</code> model defines the discount amount that is
applied. Each adjustment is created by a <code>Spree::PromotionAction</code>.</p><p>Every time that the promotion adjustment needs to be recalculated, the
<code>Spree::PromotionRules</code> are re-checked to ensure the promotion is still
eligible.</p><p>Note that shipments and taxes can also create adjustments. See the adjustments
documentation for more information.</p><h2 id="eligibility"><a href="#eligibility" aria-hidden="true" class="header-anchor">#</a> Eligibility</h2><p><code>Spree::Promotion</code>'s performs a number of checks to determine whether a
promotion is eligible to be applied.</p><p>First, it checks that the promotion is active, that its usage limit has not been
reached, that its promotion code usage limit has not be reached, and that all of
the products are promotable products. Finally, it checks the
<code>Spree::PromotionRule</code>s.</p><p>If all of these checks pass, then the promotion is eligible.</p><p>See the <code>eligible?</code> method defined in the <a href="https://github.com/solidusio/solidus/blob/master/core/app/models/spree/promotion.rb" target="_blank" rel="noopener noreferrer">Spree::Promotion
model</a>:</p><pre class="language-ruby"><code><span class="token comment"># models/spree/promotion.rb : line 123</span>
<span class="token keyword">def</span> eligible<span class="token operator">?</span><span class="token punctuation">(</span>promotable<span class="token punctuation">,</span> promotion_code<span class="token punctuation">:</span> <span class="token keyword">nil</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">if</span> inactive<span class="token operator">?</span>
  <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">if</span> usage_limit_exceeded<span class="token operator">?</span>
  <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">if</span> promotion_code <span class="token operator">&amp;&amp;</span> promotion_code<span class="token punctuation">.</span>usage_limit_exceeded<span class="token operator">?</span>
  <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">if</span> blacklisted<span class="token operator">?</span><span class="token punctuation">(</span>promotable<span class="token punctuation">)</span>
  <span class="token operator">!</span><span class="token operator">!</span><span class="token function">eligible_rules</span><span class="token punctuation">(</span>promotable<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre><p>Note that promotions without rules are eligible by default.</p><p>Once the promotion is confirmed eligible, the promotion can be activated through
the relevant <code>Spree::PromotionHandler</code>.</p><h2 id="promotion-flow"><a href="#promotion-flow" aria-hidden="true" class="header-anchor">#</a> Promotion flow</h2><p>This section provides a high-level view of the promotion system in action. For
the sake of this example, the store administrator is creating a free shipping
promotion for orders over $100 USD.</p><ol><li>The administrator creates a <code>Spree::Promotion</code> from the Solidus backend.</li></ol><ul><li>They create a name, description, and optional category for the promotion.</li><li>They choose not to set a usage limit for the promotion.</li><li>They choose not to set a start or end date for the promotion.</li><li>They choose the &quot;Apply to all orders&quot; activation method. Alternatively, they
could have chosen to apply promotions via a promotion code or a URL.</li></ul><ol start="2"><li>The administrator creates <code>Spree::PromotionRule</code>s for the promotion.
<ul><li>In this case, they use the rule type &quot;Item Total&quot;
(<code>Spree::Promotion::Rules::ItemTotal</code>) and set the rule so that the
order must be greater than $100 USD.</li></ul></li><li>The administrator creates <code>Spree::PromotionAction</code>s for the promotion.</li></ol><ul><li>They use promotion action type &quot;Free shipping&quot;, which uses the
<code>Spree::Promotion::Actions::Shipping</code> model. In this case, the only
available action is &quot;Makes all shipments for the order free&quot;.</li><li>Because the promotion action requires a shipment, the
<code>Spree::PromotionHandler::Shipping</code> will be used when it is time to activate
the promotion.</li></ul><p>Different types of promotions would change the customer's experience of
promotion activation. For example, the customer might be required to enter a
promotion code to activate some promotions, while a another promotion could be
applied automatically.</p><p>In this case, because the administrator used the &quot;Apply to all orders&quot;
activation method, the promotion is applied automatically:</p><ol><li>The customer adds items to their cart. The <code>Spree::Order</code> total is greater
than $100 USD.</li><li>The customer begins the checkout process.</li><li>The customer enters their shipping information.</li><li>The <code>Spree::PromotionHandler::Shipping</code> handler checks that the
<code>Spree::PromotionRule</code>s are met. Because the order total is
greater than $100 USD, the promotion is eligible.</li><li>The <code>Spree::PromotionHandler::Shipping</code> activates the promotion.</li><li>The <code>Spree::PromotionAction</code> associated with the promotion is computed and
applied as a <code>Spree::Adjustment</code> that negates the order's shipping charges..
The customer's shipping is now free.</li><li>The customer completes the checkout process.</li></ol></div><div class="content edit-link"><a href="https://github.com/solidusio/solidus/edit/master/guides/promotions/overview.md" target="_blank" rel="noopener noreferrer">Edit this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/solidus/returns/reimbursement-types.html" class="prev">
          Reimbursement types
        </a></span><span class="next"><a href="/solidus/promotions/promotion-rules.html">
          Promotion rules
        </a> →
      </span></p></div></div></div></div>
    <script src="/solidus/assets/js/29.a582c0f5.js" defer></script><script src="/solidus/assets/js/app.8a40fd93.js" defer></script>
  </body>
</html>
